# 审计日志（Audit Log）

审计日志（Audit Log）功能让您实时跟踪 EMQX 集群的重要操作变更，是企业用户遵守合规要求、确保数据安全的关键工具。通过审计日志，企业用户可以方便地查看谁通过何种方式，在何时执行了哪些关键操作，以实现运营过程中的合规性和安全性审计。

## 审计日志记录范围

EMQX 审计日志支持记录来自 [Dashboard](../dashboard/introduction.md) 以及 [CLI](../admin/cli.md) 的变更性操作，例如 Dashboard 用户登录，对客户端、访问控制以及数据集成等资源的修改。而指标获取、客户端列表查询等只读操作则不会被记录。

## 审计日志配置

EMQX 默认启用审计日志，并以日志形式保存在 `./log/audit.log.1` 文件中，方便企业用户深入分析审计记录，并集成到现有的日志管理系统中，满足合规和数据安全需求。

你可以在[配置文件 - 审计日志](../configuration/configuration-manual.md#审计日志)或 Dashboard **管理** -> **日志** -> **审计日志**页面中调整参数配置或禁用它。

后续版本 EMQX 还将支持在 Dashboard 上直接查看，或通过 REST API 查询与获取审计日志，方便检查操作记录。

<!-- TODO 未来版本支持 -->
<!-- 通过这两种方法，EMQX 提供了灵活且全面的审计日志支持，使企业用户能够根据自己的需求选择最适合的方式来管理和查看审计日志。 -->

## 审计日志结构

来自不同操作方式的操作记录，审计日志包含的字段有所不同。

### 来自 Dashboard 的操作记录

包含操作用户、操作对象和操作结果等信息。

| 字段名称     | 类型 | 描述                                                                |
| ------------ | ---- | ------------------------------------------------------------------- |
| time         | 整数 | 时间戳，表示日志记录的时间，以微秒为单位。                          |
| level        | 字符 | 日志级别。                                                          |
| msg          | 字符 | 操作描述。                                                          |
| from         | 字符 | 请求来源，`dashboard`、`cli` 分别表示来自 Dashboard 与 CLI 的操作。 |
| node         | 字符 | 节点名称，表示执行操作的节点或服务器。                              |
| username     | 字符 | 执行操作的用户，当来源为 `from_api` 时存在该字段。                  |
| method       | 字符 | HTTP 请求方法，`post`, `put`, `delete` 对应创建、更新、删除操作。   |
| operate_id   | 字符 | 请求的 REST API 路径，请参考 [REST API](../admin/api.md)。          |
| bindings     | 对象 | 具体的请求对象信息，对应 `operate_id` 中的占位符。                  |
| auth_type    | 字符 | 认证类型，表示用于身份验证的方法或机制，固定为 `jwt_token`。        |
| query_string | 对象 | HTTP 请求中的 URL 查询参数。                                        |
| code         | 整数 | HTTP 响应码，表示操作的结果状态。                                   |
| headers      | 对象 | HTTP 请求头信息，包括客户端标识、请求来源等。                       |
| duration_ms  | 整数 | 操作执行时间，以毫秒为单位。                                        |
| body         | 对象 | HTTP 请求体，包含操作的详细信息。                                   |

### 来自 CLI 的操作记录

包含执行的命令、调用参数等信息。

| 字段名称    | 类型 | 描述                                                                |
| ----------- | ---- | ------------------------------------------------------------------- |
| time        | 整数 | 时间戳，表示日志记录的时间，以微秒为单位。                          |
| level       | 字符 | 日志级别。                                                          |
| msg         | 字符 | 操作描述。                                                          |
| from        | 字符 | 请求来源，`dashboard`、`cli` 分别表示来自 Dashboard 与 CLI 的操作。 |
| node        | 字符 | 节点名称，表示执行操作的节点或服务器。                              |
| duration_ms | 整数 | 操作执行时间，以毫秒为单位。                                        |
| cmd         | 字符 | 执行的具体命令操作，支持的命令请参考 [CLI](../admin/cli.md)。       |
| args        | 数组 | 命令附加的参数，多个参数使用数组分割。                              |
